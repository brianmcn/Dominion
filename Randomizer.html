<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Dominion!</title>
        <script type="text/javascript">

const prosperity = [
  'Bank',
  'Bishop',
  'City',
  'Contraband',
  'Counting House',
  'Expand',
  'Forge',
  'Goons',
  'Grand Market',
  'Hoard',
  'Investment',
  'King\'s Court',
  'Loan',
  'Monument',
  'Mountebank',
  'Mint',
  'Rabble',
  'Royal Seal',
  'Quary',
  'Peddler',
  'Talisman',
  'Trade Route',
  'Vault',
  'Venture',
  'Watchtower',
  'Worker\'s Village',
];

const darkAges = [
  'Altar',
  'Armory',
  'Band of Misfits',
  ['Bandit Camp', 'Spoils'],
  'Beggar',
  'Catacombs',
  'Count',
  'Counterfeit',
  ['Cultist', 'Ruins'],
  ['Death Cart', 'Ruins'],
  'Feodum',
  'Forager',
  'Fortress',
  ['Hermit', 'Madman'],
  'Graverobber',
  'Hunting Grounds',
  'Ironmonger',
  'Junk Dealer',
  'Knights',
  'Market Square',
  ['Marauder', 'Ruins', 'Spoils'],
  'Mystic',
  ['Pillage', 'Spoils'],
  'Poor House',
  'Procession',
  'Rats',
  'Rebuild',
  'Rogue',
  'Sage',
  'Scavenger',
  'Squire',
  'Storeroom',
  'Urchin',
  'Vagrant',
  'Wandering Minstrel'];

const dominion = [
  'Cellar',
  'Chapel',
  'Moat',
  'Harbinger',
  'Village',
  'Merchant',
  'Workshop',
  'Bureaucrat',
  'Vassal',
  'Gardens',
  'Militia',
  'Moneylender',
  'Remodel',
  'Smithy',
  'Bandit',
  'Poacher',
  'Throne Room',
  'Council Room',
  'Festival',
  'Laboratory',
  'Library',
  'Market',
  'Mine',
  'Witch',
  'Sentry',
  'Artisan',
];

const hinterlands = [
  'Crossroads',
  'Duchess',
  'Fools Gold',
  'Develop',
  'Oasis',
  'Oracle',
  'Scheme',
  'Tunnel',
  'Jack of all Trades',
  'Noble Brigand',
  'Nomad Camp',
  'Silk Road',
  'Spice Merchant',
  'Trader',
  'Cache',
  'Cartographer',
  'Embassy',
  'Haggler',
  'Highway',
  'Ill-Gotten Gains',
  'Inn',
  'Mandarin',
  'Margrave',
  'Stables',
  'Border Village',
  'Farmland'];

const intrigue = [
  'Courtyard',
  'Pawn',
  'Secret Chamber',
  'Great Hall',
  'Masquerade',
  'Shanty Town',
  'Steward',
  'Swindler',
  'Wishing Well',
  'Baron',
  'Bridge',
  'Conspirator',
  'Coppersmith',
  'Ironworks',
  'Mining Village',
  'Scout',
  'Duke',
  'Minion',
  'Saboteur',
  'Torturer',
  'Trading Post',
  'Tribute',
  'Upgrade',
  'Harem',
  'Nobles'];

const seaside = [
  'Embargo',
  'Haven',
  'Lighthouse',
  'Native Village',
  'Pearl Diver',
  'Ambassador',
  'Fishing Village',
  'Lookout',
  'Smugglers',
  'Warehouse',
  'Caravan',
  'Cutpurse',
  'Island',
  'Navigator',
  'Pirate Ship',
  'Salvager',
  'Sea Hag',
  'Treasure Map',
  'Bazaar',
  'Explorer',
  'Ghost Ship',
  'Merchant Ship',
  'Outpost',
  'Tactician',
  'Treasury',
  'Wharf'];

const guilds = [
  'Advisor',
  'Baker',
  'Butcher',
  'Candlestick Maker',
  'Doctor',
  'Herald',
  'Journeyman',
  'Masterpiece',
  'Merchant Guild',
  'Plaza',
  'Soothsayer',
  'Stonemason',
  'Taxman'];

const nocturne = [
  ['Druid', 'Boons'],
  'Faithful Hound',
  'Guardian',
  'Monastery',
  ['Pixie', 'Boons', 'Goat'],
  ['Tracker', 'Boons', 'Pouch'],
  'Changeling',
  ['Fool', 'Lost in the Woods', 'Boons', 'Lucky Coin'],
  'Ghost Town',
  ['Leprechaun', 'Wish', 'Hex'],
  'Night Watchman',
  ['Secret Cave', 'Magic Lamp'],
  ['Bard', 'Boons'],
  ['Blessed Village', 'Boons'],
  ['Cemetery', 'Haunted Mirror'],
  'Conclave',
  ['Devil\'s Workshop', 'Imp'],
  ['Exorcist', 'Imp', 'Will o\' Wisp', 'Ghost'],
  ['Necromancer', 'Zombies'],
  ['Shepherd', 'Pasture'],
  ['Skulk', 'Hexes'],
  'Cobbler',
  'Crypt',
  ['Cursed Village', 'Hexes'],
  'Den of Sin',
  ['Idol', 'Boons', 'Curse'],
  ['Pooka', 'Cursed Gold'],
  ['Sacred Grove', 'Boons'],
  ['Tormentor', 'Imp', 'Hexes'],
  'Tragic Hero',
  ['Vampire', 'Hexes', 'Bat'],
  ['Werewolf', 'Hexes'],
  'Raider',
];

const all = {
  'DA': darkAges,
  'DO': dominion,
  'HI': hinterlands,
  'IN': intrigue,
  'SE': seaside,
  'GU': guilds,
  'NO': nocturne,
  'PR': prosperity,
};

const shuffle = function(a) {
  let currentIndex = a.length;

  // While there remain elements to shuffle...
  while (0 !== currentIndex) {
    // Pick a remaining element...
    const randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex -= 1;

    // And swap it with the current element.
    const temporaryValue = a[currentIndex];
    a[currentIndex] = a[randomIndex];
    a[randomIndex] = temporaryValue;
  }
};

const sortDashU = function(a, comparision ) {
  a.sort( comparision );
  for (let i = 0; i < a.length -1;) {
    const current = a[i];
    const next = a[i+1];
    if (comparision(current, next) == 0) {
      a.splice(i, 1);
    } else {
      i++;
    }
  }
};

class Card {
  constructor(set, value) {
    this.set = set;
    if (typeof(value) == 'string') {
      this.name = value;
      this.extra = [];
    } else {
      [this.name] = value;
      this.extra = value.slice(1).map( function(i) {
        return new Card(set, i + '*');
      });
    }
    return this;
  }

  toString() {
    return this.set + ' - ' + this.name;
  }

  compareTo(lhs, rhs) {
    const i = lhs.set.localeCompare(rhs.set);
    if (i != 0) return i;
    return lhs.name.localeCompare(rhs.name);
  }
}

function pickCards() {
  const flatAll= [];
  Object.keys(all).forEach( set => {
    const checkbox = document.getElementById(set);
    if (checkbox.checked) {
      const cards = all[set];
      for (let i = 0; i < cards.length; i++) {
        const card = new Card(set, cards[i]);
        flatAll.push(card);
      }
    }
  });

  shuffle(flatAll);
  let chosen = flatAll.slice(0, 10);
  const originalLength = chosen.length;
  for (let i = 0; i < originalLength; i++) {
    const card = chosen[i];
    chosen = chosen.concat(card.extra);
  }

  sortDashU( chosen, Card.prototype.compareTo );

  document.getElementById('cards').innerHTML = chosen.join('<BR>');
}
        </script>

    </head>
    <body onload="pickCards()">
        <h1>Dominion randomizer</h1>
        <p>This page chooses 10 random cards from
        <ul>
            <li><input id=DO type=checkbox checked onchange="pickCards()">Dominion</input></li>
            <li><input id=DA type=checkbox checked onchange="pickCards()">Dark Ages</input></li>
            <li><input id=GU type=checkbox checked onchange="pickCards()">Guilds</input></li>
            <li><input id=HI type=checkbox checked onchange="pickCards()">Hinterlands</input></li>
            <li><input id=IN type=checkbox checked onchange="pickCards()">Intrigue</input></li>
            <li><input id=SE type=checkbox checked onchange="pickCards()">Seaside</input></li>
            <li><input id=NO type=checkbox checked onchange="pickCards()">Nocturne</input></li>
            <li><input id=PR type=checkbox checked onchange="pickCards()">Prosperity</input></li>
        </ul>
        <input type=button onclick="pickCards()" value="Pick Again"></input>
        <br/>
        <div id="cards"></div>
    </body>
</html>

